# Quest System With Growing Dread - Metaprompt Example

## How the Master Metaprompt Generates a Dread-Aware Quest System

### Generated Quest Metaprompt

```yaml
name: quest_system_generator
narrative_role: |
  Quests are the vehicle through which players experience the growing horror.
  Early quests establish normalcy. Later quests reveal the inescapable truth.
  
dependencies:
  narrative_state: "narrative_manifest.json"
  world_data: "biome_manifest.json" 
  npc_data: "npc_manifest.json"
  companion_data: "companion_manifest.json"

generation_instructions: |
  Generate a complete quest system for Dragon's Labyrinth that:
  
  1. STARTS innocent - "Help farmer find lost sheep"
  2. GRADUALLY reveals horror - "Why are all the sheep dead?"
  3. BECOMES desperate - "Find anyone still willing to fight"
  4. ENDS in dread - "Prepare for what cannot be stopped"
  
  The dragon is NEVER just a boss to defeat. It's a force of nature,
  perhaps even a protector of something worse.

dread_progression:
  level_0_sunshine:
    quest_types: [fetch, escort, explore]
    tone: "Cheerful adventure, exciting opportunities"
    npc_willingness: "Everyone eager to help"
    rewards: "Gold, items, reputation"
    example: "Deliver supplies to neighboring village"
    
  level_1_shadows:
    quest_types: [investigate, rescue, defend]
    tone: "Something seems off..."
    npc_willingness: "Some hesitation about certain topics"
    rewards: "Information, warnings, protective charms"
    example: "Investigate why the birds stopped singing"
    
  level_2_unease:
    quest_types: [survival, escape, uncover]
    tone: "Growing concern, whispered warnings"
    npc_willingness: "Many refuse dragon-related quests"
    rewards: "Escape routes, hiding places, fear-based tools"
    example: "Help family flee before 'it' returns"
    
  level_3_fear:
    quest_types: [desperate_search, last_stand, truth_seeking]
    tone: "Open fear, abandonment of hope"
    npc_willingness: "Most NPCs lock doors when you approach"
    rewards: "Final warnings, suicide notes, maps to 'safe' places"
    example: "Find the last scholar who knows the truth"
    
  level_4_despair:
    quest_types: [companion_trauma, final_preparations, acceptance]
    tone: "Resignation, preparing for the end"
    npc_willingness: "Ghost towns, empty streets"
    rewards: "Letters to loved ones, final confessions"
    example: "Help companion write their will"
    
  level_5_horror:
    quest_types: [survival_horror, witness_accounts, labyrinth_prep]
    tone: "Pure dread, reality breaking down"
    npc_willingness: "Only the mad remain"
    rewards: "Fragments of truth, labyrinth maps, sanity anchors"
    example: "Follow the mad prophet's final journey"
```

### Generated Quest Code Structure

```gdscript
# Generated by quest_system_generator
extends Node
class_name QuestSystem

signal dread_increased(new_level: int)
signal quest_tone_shifted(quest: Quest, new_tone: String)

var dread_level: int = 0
var active_quests: Array[Quest] = []
var completed_quests: Dictionary = {}

func generate_quest_for_location(location: String, npc: NPC) -> Quest:
    var quest = Quest.new()
    
    # Base quest generation
    quest.id = generate_quest_id(location, npc, dread_level)
    quest.giver = npc
    
    # CRITICAL: Quest type changes with dread
    match dread_level:
        0:
            quest = generate_innocent_quest(quest, location, npc)
        1:
            quest = generate_shadowed_quest(quest, location, npc)
        2:
            quest = generate_uneasy_quest(quest, location, npc)
        3:
            quest = generate_fearful_quest(quest, location, npc)
        4:
            quest = generate_desperate_quest(quest, location, npc)
        5:
            quest = generate_horror_quest(quest, location, npc)
    
    # NPC willingness check
    if not npc.willing_to_give_quest(dread_level):
        return null  # NPC refuses to talk
    
    return quest

func generate_innocent_quest(quest: Quest, location: String, npc: NPC) -> Quest:
    var templates = [
        {
            "title": "Fresh Bread Delivery",
            "description": "The baker needs someone to deliver fresh bread to the mill.",
            "objective": "Deliver 5 loaves to the miller",
            "reward": {"gold": 50, "reputation": 5},
            "dialogue": {
                "offer": "Beautiful morning! Could you help me with deliveries?",
                "complete": "Thank you! The miller will be so pleased!"
            }
        },
        {
            "title": "Lost Lamb",
            "description": "A shepherd's lamb wandered into the woods.",
            "objective": "Find and return the lost lamb",
            "reward": {"gold": 30, "item": "wool_cloak"},
            "dialogue": {
                "offer": "My little lamb loves to explore. Could you find her?",
                "complete": "Oh wonderful! She looks happy to be home!"
            }
        }
    ]
    
    var chosen = templates[randi() % templates.size()]
    quest.merge_template(chosen)
    quest.tone = "innocent"
    
    return quest

func generate_shadowed_quest(quest: Quest, location: String, npc: NPC) -> Quest:
    var templates = [
        {
            "title": "Silent Birds",
            "description": "The birds stopped singing yesterday. Find out why.",
            "objective": "Investigate the silent forest",
            "reward": {"gold": 75, "information": "dragon_rumor_1"},
            "dialogue": {
                "offer": "Have you noticed? The birds... they've gone quiet.",
                "complete": "Dead? All of them? But... why?"
            },
            "discovery": "You find hundreds of dead birds, all facing the mountain"
        },
        {
            "title": "Missing Merchant",
            "description": "The weekly merchant hasn't arrived. He's never late.",
            "objective": "Search the trade route",
            "reward": {"gold": 100, "item": "merchant_journal"},
            "dialogue": {
                "offer": "He always comes on Tuesday. Always. This isn't right.",
                "complete": "Just his wagon? No body? That's... somehow worse."
            },
            "discovery": "Wagon abandoned, goods untouched, large claw marks"
        }
    ]
    
    var chosen = templates[randi() % templates.size()]
    quest.merge_template(chosen)
    quest.tone = "shadowed"
    
    # Add investigation mechanics
    quest.add_investigation_phase()
    
    return quest

func generate_fearful_quest(quest: Quest, location: String, npc: NPC) -> Quest:
    var templates = [
        {
            "title": "The Last Scholar",
            "description": "Find the scholar who knows the truth about the dragon.",
            "objective": "Locate Scholar Aldric before it's too late",
            "reward": {"knowledge": "dragon_truth", "item": "labyrinth_key"},
            "dialogue": {
                "offer": "[Whispering] They say he knows... but he's hiding. They're all hiding.",
                "complete": "[Eyes wide] He told you? Then you know we're all doomed."
            },
            "warnings": [
                "NPCs flee when you mention the scholar",
                "Doors slam shut as you approach",
                "You find 'TURN BACK' written in blood"
            ]
        },
        {
            "title": "Evacuation",
            "description": "Help the remaining villagers escape before nightfall.",
            "objective": "Evacuate 10 villagers before the dragon arrives",
            "reward": {"gold": 0, "karma": 100, "guilt": -50},
            "dialogue": {
                "offer": "[Panicked] Please! Help us get out! It's coming tonight!",
                "complete": "[Sobbing] We couldn't save them all..."
            },
            "mechanics": {
                "timer": 300,  # 5 minutes real-time
                "failure_consequence": "Hear screams in the distance"
            }
        }
    ]
    
    var chosen = templates[randi() % templates.size()]
    quest.merge_template(chosen)
    quest.tone = "fearful"
    
    # Add horror elements
    quest.add_timer_pressure()
    quest.add_failure_consequences()
    
    return quest

func generate_horror_quest(quest: Quest, location: String, npc: NPC) -> Quest:
    # At maximum dread, quests become surreal
    var templates = [
        {
            "title": "The Invitation",
            "description": "You've been invited to dinner. You must attend.",
            "objective": "Attend the feast",
            "reward": {"sanity": -20, "truth": "final_revelation"},
            "dialogue": {
                "offer": "[Not the NPC's voice] Come. The dragon is waiting.",
                "complete": "[Your own voice] Why did you come here?"
            },
            "horror_elements": {
                "npc_face_changes": true,
                "reality_distortion": true,
                "cannot_refuse": true
            }
        },
        {
            "title": "Your Companion's Request",
            "description": "[Companion] asks you to do something unthinkable.",
            "objective": "???",
            "reward": {"ending_flag": "betrayal_path"},
            "dialogue": {
                "offer": "[Companion, wrong voice] Kill me. Before I become like them.",
                "complete": "[Silence]"
            },
            "horror_elements": {
                "companion_corruption": true,
                "moral_horror": true,
                "permanent_consequences": true
            }
        }
    ]
    
    var chosen = templates[randi() % templates.size()]
    quest.merge_template(chosen)
    quest.tone = "horror"
    
    # Reality breaks down
    quest.add_sanity_effects()
    quest.add_permanent_consequences()
    
    return quest

# Companion quest integration
func check_companion_trauma_quests():
    for companion in get_companions():
        if companion.trauma_level >= 3 and not companion.therapy_quest_given:
            generate_therapy_quest(companion)

func generate_therapy_quest(companion: Companion) -> Quest:
    var quest = Quest.new()
    quest.id = "therapy_" + companion.name
    quest.title = companion.name + " Needs Help"
    quest.description = "Your companion is struggling with what they've seen."
    
    match companion.trauma_trigger:
        "dragon_sighting":
            quest.objective = "Find a quiet place to talk about the dragon"
        "combat_death":
            quest.objective = "Help them process the violence"
        "labyrinth_preview":
            quest.objective = "Discuss the nightmares"
    
    quest.dialogue = {
        "offer": companion.generate_trauma_dialogue(),
        "complete": companion.generate_healing_dialogue()
    }
    
    quest.on_complete = func():
        companion.trauma_level -= 1
        companion.trust_level += 2
    
    return quest
```

### Dynamic Quest Adaptation

```gdscript
# The quest system responds to world events
func on_world_event(event: WorldEvent):
    match event.type:
        WorldEvent.DRAGON_SIGHTING:
            # All active quests become more urgent
            for quest in active_quests:
                quest.add_urgency("The dragon has been seen!")
                quest.modify_dialogue("nervous")
                
        WorldEvent.TOWN_ABANDONED:
            # Quests from that town auto-fail
            for quest in active_quests:
                if quest.origin_town == event.location:
                    quest.fail("The town is empty now...")
                    
        WorldEvent.COMPANION_BREAKDOWN:
            # Generate emergency companion quest
            generate_emergency_companion_quest(event.companion)

# Quest rewards change with dread
func calculate_quest_reward(quest: Quest) -> Dictionary:
    var base_reward = quest.base_reward.duplicate()
    
    # Gold becomes worthless as dread increases
    if dread_level >= 3:
        base_reward.gold *= 0.1
        base_reward.information_value *= 5.0
        
    # At high dread, survival items are everything
    if dread_level >= 4:
        base_reward.erase("gold")
        base_reward.survival_supplies = true
        base_reward.sanity_items = true
        
    return base_reward
```

### Integration with Other Systems

```yaml
quest_integration:
  dialogue_system:
    - NPCs reference ongoing quests
    - Dialogue options change based on quest progress
    - Failed quests affect NPC reactions
    
  world_system:
    - Quests can permanently change locations
    - Failed evacuation quests = ghost towns
    - Completed horror quests = reality distortions
    
  companion_system:
    - Companions comment on quest morality
    - Traumatic quests increase companion stress
    - Some quests can only be done with/without certain companions
    
  combat_system:
    - Combat difficulty scales with quest dread level
    - Horror quests may have no combat solution
    - Enemies flee from high-dread players
```

## The Brilliance of This Approach

1. **Quests ARE the Horror**: Not just tasks, but vehicles for growing dread
2. **NPC Reactions**: The world reacts to your curse of being the "hero"
3. **Companion Integration**: Your friends suffer alongside you
4. **Reality Breakdown**: Late-game quests question what's real
5. **No Power Fantasy**: You don't become stronger, you become marked

The quest system doesn't just give you things to do - it slowly reveals that you're trapped in a horror story, and every quest completed brings you closer to an ending you might not want.
