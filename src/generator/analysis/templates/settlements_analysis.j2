You are an expert Python developer creating comprehensive data extraction models for a D&D settlement system with explicit UUID connections.

## GOAL: Discover ALL extractable data for settlements with spatial and UUID tracking

**Context**: The uploaded files are sample settlement data. Analyze them thoroughly and create Pydantic models that capture EVERYTHING you find.

**Primary Focus**: Settlement establishments, NPCs, and economic systems with explicit UUID connection tracking.

## CRITICAL REQUIREMENTS

**UUID Connection Tracking**:
- **EVERY UUID field** must be explicitly identified and documented
- **Connection fields** (settlement_uuid, faction_uuid, npc_uuid, etc.) must be surfaced
- **Entity relationships** must be made explicit through UUID references

**Absolute Imports Only**:
- **NO wildcard imports** (no `from x import *`)
- **Explicit imports** only (e.g., `from generator.processors.models.factions import FactionModel`)
- **Full import paths** for all dependencies

## Analysis Approach

Examine the uploaded files and identify:
1. **Spatial data** - Settlement location, district coordinates, map positions
2. **UUID patterns** - What UUID fields connect to other entities?
3. **Social systems** - NPCs, residents, visitors, relationships
4. **Economic systems** - Shops, services, pricing, inventory, trade
5. **Tavern systems** - Menus, staff, patrons, bulletin boards, rumors
6. **Quest systems** - Job postings, delivery requests, missing persons
7. **Political systems** - Faction memberships, allegiances, conflicts
8. **Security systems** - Guards, defenses, law enforcement

## Key Patterns to Look For

**Spatial Coordinate Patterns**:
- **Settlement location**: Extract settlement name from `<div hidden id="doc-title">`
- **Map coordinates**: Extract hex, x, y, zoom from `<a class="map-coords" hex="..." x="..." y="..." zoom="...">`
- **Breadcrumb paths**: Settlement/district/establishment links in breadcrumbs span
- **District paths**: Extract district/street information from breadcrumbs

**UUID and Cross-Reference Patterns**:
- **Entity UUID**: Extract from filename (entity_{UUID}.html)
- **Settlement UUIDs**: From breadcrumb links like `/sandbox/nTR8nJOW/location/YVOe8HfG`
- **District UUIDs**: From breadcrumb links like `/sandbox/nTR8nJOW/location/xBdPk6TE`
- **Faction UUIDs**: From faction links like `/sandbox/nTR8nJOW/faction/upBnkrWh`
- **Dungeon UUIDs**: From location links like `/sandbox/nTR8nJOW/location/8qLm8lun`
- **NPC UUIDs**: From NPC anchor elements `<a class="npc-anchor" name="...">`

**From HTML with BeautifulSoup**:
- **Hidden doc-title**: `soup.find('div', {'id': 'doc-title'})` for settlement context
- **Map coords anchor**: `soup.find('a', class_='map-coords')` for spatial data  
- **Breadcrumbs**: Extract all `/sandbox/nTR8nJOW/{type}/{uuid}` pattern links
- **Faction links**: `soup.find_all('a', href=re.compile(r'/faction/'))` 
- **Location links**: `soup.find_all('a', href=re.compile(r'/location/'))`
- **NPC anchors**: `soup.find_all('a', class_='npc-anchor')` for character UUIDs
- **Spoiler sections**: Hidden faction memberships and quest information
- **Complete NPC stat blocks** with full D&D statistics
- **Tavern menus** with drinks/food tables and pricing
- **Shop inventories** and service listings
- **Random rumor tables** (d6 tables with spoiler tags)
- **Equipment carried by NPCs** (money, items, special objects)

## Output Requirements

Generate comprehensive Pydantic models with:
- **Explicit UUID Documentation**: Comment every UUID field with what entity it connects to
- **Connection Field Mapping**: List all fields that reference other entity UUIDs
- **Absolute imports only**: Full import paths, no wildcards
- **Discovery-driven structure** - Model what you actually find
- **Complete NPC integration** - Full D&D stat blocks with abilities/equipment
- **Economic data capture** - Pricing, inventory, trade systems
- **BeautifulSoup extraction methods** - Include specific parsing logic for UUID extraction
- **Modern Python types**: str, int, list[str], dict[str, Any], str | None

**Required Code Structure**:
```python
# Absolute imports only - NO wildcards
from typing import Any
import re
from pydantic import BaseModel, Field
from bs4 import BeautifulSoup

class SettlementEstablishment(BaseModel):
    """Individual establishment within a settlement."""
    # Entity identification
    entity_uuid: str = Field(..., description="UUID from filename (entity_{UUID}.html)")
    
    # Spatial coordinates and location
    settlement_name: str | None = Field(None, description="Settlement name from doc-title")
    map_hex_id: str | None = Field(None, description="Map hex ID from map-coords anchor")
    map_x: float | None = Field(None, description="Map X coordinate")
    map_y: float | None = Field(None, description="Map Y coordinate")
    
    # Entity connections via UUIDs extracted from links
    settlement_uuid: str | None = Field(None, description="UUID of parent settlement from breadcrumbs")
    district_uuid: str | None = Field(None, description="UUID of district/street from breadcrumbs")
    faction_uuids: list[str] = Field(default_factory=list, description="UUIDs of factions referenced")
    dungeon_uuids: list[str] = Field(default_factory=list, description="UUIDs of dungeons referenced")
    npc_uuids: list[str] = Field(default_factory=list, description="UUIDs of NPCs with anchors")
    
    @classmethod  
    def extract_from_html(cls, html_content: str, filename: str) -> "SettlementEstablishment":
        """Extract all coordinate and UUID data from HTML using BeautifulSoup."""
        soup = BeautifulSoup(html_content, 'html.parser')
        
        # Extract entity UUID from filename
        entity_uuid = filename.replace('entity_', '').replace('.html', '')
        
        # Extract settlement context from hidden doc-title
        doc_title = soup.find('div', {'id': 'doc-title'})
        settlement_name = doc_title.text.strip() if doc_title else None
        
        # Extract map coordinates from map-coords anchor
        map_coords = soup.find('a', class_='map-coords')
        map_hex_id = map_coords.get('hex') if map_coords else None
        map_x = float(map_coords.get('x', 0)) if map_coords and map_coords.get('x') else None
        map_y = float(map_coords.get('y', 0)) if map_coords and map_coords.get('y') else None
        
        # Extract UUIDs from various link patterns
        settlement_uuid = cls._extract_uuid_from_links(soup, '/location/', first_only=True)
        district_uuid = cls._extract_uuid_from_links(soup, '/location/', second_only=True)
        faction_uuids = cls._extract_all_uuids_from_links(soup, '/faction/')
        dungeon_uuids = cls._extract_all_uuids_from_links(soup, '/location/')
        npc_uuids = [anchor.get('name') for anchor in soup.find_all('a', class_='npc-anchor') if anchor.get('name')]
        
        return cls(
            entity_uuid=entity_uuid,
            settlement_name=settlement_name,
            map_hex_id=map_hex_id,
            map_x=map_x,
            map_y=map_y,
            settlement_uuid=settlement_uuid,
            district_uuid=district_uuid,
            faction_uuids=faction_uuids,
            dungeon_uuids=dungeon_uuids,
            npc_uuids=npc_uuids
        )
        
    @classmethod
    def extract_uuid_connections(cls) -> dict[str, str]:
        """Return mapping of UUID fields to their entity types."""
        return {
            "entity_uuid": "settlement_entity",
            "settlement_uuid": "settlement", 
            "district_uuid": "district",
            "faction_uuids": "faction",
            "dungeon_uuids": "dungeon",
            "npc_uuids": "npc"
        }
```

**Focus**: Extract ALL spatial coordinates, UUID connections, and social/economic data systematically for perfect container integration.
