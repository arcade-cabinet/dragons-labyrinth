# Generate Boss and Mini-Boss System

## Context
Create memorable boss encounters that serve as skill checks and major progression milestones. Bosses should leverage the hex-based combat system while introducing unique mechanics that require strategy beyond normal combat.

## Mini-Boss System

### 1. Mini-Boss Types
Based on discovered monster assets, generate unique mini-bosses:
{% for monster in discovered_monsters %}
- **{{ monster.name }} Alpha**:
  - Base creature: {{ monster.base_type }}
  - Size: Takes up 2-3 hexes
  - Unique mechanic: {{ monster.special_ability }}
  - Drops: {{ monster.loot_table }}
{% endfor %}

### 2. Mini-Boss Mechanics

#### Enhanced Stats
- 5x health of regular enemies
- 2x damage output
- Special armor that reduces first 10 damage per hit
- Immunity to certain status effects
- Multiple actions per turn (2-3 AP pools)

#### Unique Behaviors
- **Phase Transitions**: At 75%, 50%, 25% health
- **Summon Minions**: Calls reinforcements
- **Area Denial**: Makes hexes dangerous/impassable
- **Rage Mode**: Increased damage when low health
- **Special Patterns**: Telegraphed but devastating attacks

### 3. Environmental Mini-Bosses
Bosses that use the hex grid creatively:
- **The Hex Shaper**: Rotates hex sections, changing terrain
- **Storm Caller**: Creates environmental hazards on hexes
- **The Divider**: Splits the arena with walls/chasms
- **Mirror Mage**: Creates duplicate hexes with illusions

## THE DRAGON'S LABYRINTH - Final Boss Experience

### Overview
The Dragon's Labyrinth IS the final boss area - a complete departure from everything else in the game. This is a first-person horror experience that breaks all established rules.

### 1. The Perspective Shift

#### Entering the Labyrinth
```gdscript
# When player enters the Dragon's Labyrinth
func enter_dragons_labyrinth():
    # Dramatic camera transition
    camera.transition_to_first_person(2.0)  # Slow, unsettling transition
    
    # Disable hex grid visibility
    hex_grid.visible = false
    
    # Enable first-person controller
    player.enable_fps_mode()
    
    # Start atmospheric horror system
    audio_system.start_labyrinth_ambience()
    
    # Begin dragon proximity tracking
    dragon_ai.start_hunting()
```

### 2. The Horror Experience

#### Atmospheric Elements
- **Complete Darkness**: Only 3-5 meters of visibility
- **Sound Design**:
  - Heavy dragon breathing (volume = 1/distance_to_dragon)
  - Echoing footsteps (yours and... others?)
  - Dripping water, distant roars
  - Whispers? Voices of previous victims?
- **Visual Effects**:
  - Fog/mist limiting visibility
  - Occasional glowing eyes in the darkness
  - Torch flickers creating moving shadows
  - Breath condensation when dragon is near

#### The Labyrinth Layout
- Procedurally generated maze (changes each attempt)
- Narrow corridors (claustrophobic)
- Sudden drops, dead ends
- Hidden passages when dragon gets too close
- No map - you're truly lost

### 3. The Ambush System

#### Surprise Encounters
```gdscript
# Random encounter triggers
func check_ambush():
    if randf() < ambush_chance:
        # Sudden footsteps behind you
        audio.play_3d("footstep_approach", behind_player)
        yield(get_tree().create_timer(0.5), "timeout")
        
        # SLAM - instant transition
        trigger_combat_encounter()

func trigger_combat_encounter():
    # Jarring transition back to hex view
    screen_flash_white()
    camera.snap_to_hex_combat_view()
    
    # Condensed combat arena (5x5 hexes only)
    spawn_combat_arena_small()
    spawn_ambush_enemies()
    
    # After combat...
    func on_combat_complete():
        # Right back into the darkness
        camera.fade_to_black()
        camera.return_to_first_person()
        # You're somewhere else now...
        reposition_player_in_maze()
```

#### Ambush Enemy Types
- **Labyrinth Cultists**: Dragon worshippers, mad from the darkness
- **Shadow Stalkers**: Barely visible, hit and run
- **The Lost**: Previous adventurers, driven insane
- **Dragon Spawn**: Small drakes that scout for the dragon

### 4. The Dragon Hunt

#### Proximity Mechanics
```gdscript
var dragon_distance = 100.0  # Starting distance in meters
var dragon_speed = 2.0  # Meters per second when hunting

func _process(delta):
    # Dragon slowly hunts you
    if player_moving:
        dragon_distance -= dragon_speed * delta * 0.5  # Slower when you move
    else:
        dragon_distance -= dragon_speed * delta  # Faster when you stop
    
    # Update breathing volume
    var volume = max(-40, -40 + (40 * (1.0 - dragon_distance/100.0)))
    dragon_breathing_audio.volume_db = volume
    
    # Proximity warnings
    if dragon_distance < 20:
        # Screen shakes slightly
        camera.shake(dragon_distance/20.0)
        
    if dragon_distance < 10:
        # Breath visible, temperature drops
        show_breath_fog()
        
    if dragon_distance < 5:
        # Can see glowing eyes
        show_dragon_eyes()
        
    if dragon_distance <= 0:
        # The dragon finds you
        trigger_dragon_encounter()
```

#### The Dragon Encounter
When the dragon finally catches you:
1. **First-Person Horror**: See the massive dragon face emerge from darkness
2. **Transition**: Explosive transition to hex combat
3. **The Arena**: Large hex arena materializes around you
4. **The Battle**: Traditional multi-phase dragon fight (but you're already terrified)

### 5. Labyrinth Progression

#### Finding the Heart
The goal isn't just to reach the dragon - it's to find the Heart of the Labyrinth:
- **Clues**: Ancient writings on walls (barely visible)
- **Sound Cues**: The heart "beats" louder as you get closer
- **False Hearts**: Decoy rooms with trap encounters
- **The True Heart**: Where you choose to face the dragon or attempt to seal it

#### Multiple Endings
1. **Fight the Dragon**: Traditional boss battle
2. **Seal the Dragon**: Puzzle/ritual ending (still dangerous)
3. **Join the Dragon**: Dark ending (become a labyrinth guardian)
4. **Escape**: Coward's ending (dragon remains a threat)

### 6. Death and Retry

#### Labyrinth Checkpoints
- **Soul Anchors**: Rare safe rooms with glowing crystals
- **Limited Saves**: Only 3 soul anchors in the entire labyrinth
- **Permadeath Mode**: Optional - no saves in the labyrinth
- **Madness System**: Each death increases "madness" (visual distortions)

### 7. Special Mechanics

#### Sanity System
```gdscript
var sanity = 100.0

# Things that reduce sanity:
- Time in darkness
- Hearing the dragon
- Seeing horrors
- Being ambushed

# Low sanity effects:
- False sounds (is that real?)
- Visual hallucinations
- Controls occasionally reverse
- Fake ambush triggers
```

#### Light Management
- **Torch System**: Limited duration, find more or craft
- **Light Attracts**: Both helps and hinders
- **Dragon Fire**: Brief illumination during breathing attacks
- **Magical Light**: Rare, but attracts all enemies

### 8. Audio Design Priority

The labyrinth MUST have incredible audio:
- **3D Positional Audio**: Every sound has a location
- **Dynamic Reverb**: Based on corridor size
- **Layered Ambience**: Multiple tracks creating unease
- **False Audio**: Sounds that aren't real (sanity-based)
- **The Dragon's Voice**: Not roars, but whispers... intelligence

### 9. The Final Confrontation

When you finally face the dragon:
- **First Phase**: Still in first-person, running from chamber to chamber
- **Second Phase**: Hex-based combat in massive arena
- **Third Phase**: Arena crumbles, back to first-person escape
- **Final Phase**: Combined - switching between both views chaotically

## Mini-Boss Locations

### 1. World Mini-Bosses
- **Forest Guardian**: Protects ancient grove
- **Dungeon Keeper**: Guards treasure rooms
- **Corrupted Hero**: Fallen champion in ruins
- **Elemental Lords**: One per biome type

### 2. Optional Super Bosses
- Hidden throughout world
- Harder than story bosses
- Drop materials for best equipment
- Unlock secret ending if all defeated

Generate complete boss system with:
- AI behavior trees for each phase
- Balanced damage/health formulas
- Visual attack telegraphs
- Dynamic music system integration
- First-person horror mechanics for Dragon's Labyrinth
- Seamless view transitions
- Psychological horror elements
